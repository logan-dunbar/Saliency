<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252" /><link rel="stylesheet" href="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\matlab-report-styles.css" type="text/css" /><title>Function details for populateSpArray</title><link rel="stylesheet" href="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\matlab-report-styles.css" type="text/css" /></head><body bgcolor="#F8F8F8"><strong>This is a static copy of a profile report</strong><p><a href="file0.html">Home</a><p><span style="font-size:14pt; background:#FFE4B0">populateSpArray (3 calls, 1886.797 sec)</span><br/><i>Generated 26-Dec-2014 12:35:15 using cpu time.</i><br/>function in file D:\Logan\Documents\MATLAB\Saliency\populateSpArray.m<br/>Copy to new window for comparing multiple runs<div class="grayline"/><div class="grayline"/><strong>Parents</strong> (calling functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td></tr><tr><td class="td-linebottomrt"><a href="file90.html">populateFrame</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">3</td></tr></table><div class="grayline"/><strong>Lines where the most time was spent</strong><br/> <p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Line Number</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Code</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="#Line118">118</a></td><td class="td-linebottomrt"><pre>color_norm = sqrt(color_l_diff...</pre></td><td class="td-linebottomrt">2048</td><td class="td-linebottomrt">294.685 s</td><td class="td-linebottomrt" class="td-linebottomrt">15.6%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=16 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line121">121</a></td><td class="td-linebottomrt"><pre>innerSum = sum(color_norm.*glo...</pre></td><td class="td-linebottomrt">2048</td><td class="td-linebottomrt">161.777 s</td><td class="td-linebottomrt" class="td-linebottomrt">8.6%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=9 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line107">107</a></td><td class="td-linebottomrt"><pre>color_l1 = repmat(frameNow.col...</pre></td><td class="td-linebottomrt">2048</td><td class="td-linebottomrt">138.368 s</td><td class="td-linebottomrt" class="td-linebottomrt">7.3%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=7 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line116">116</a></td><td class="td-linebottomrt"><pre>color_b_diff = color_b1 - colo...</pre></td><td class="td-linebottomrt">2048</td><td class="td-linebottomrt">138.346 s</td><td class="td-linebottomrt" class="td-linebottomrt">7.3%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=7 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line115">115</a></td><td class="td-linebottomrt"><pre>color_a_diff = color_a1 - colo...</pre></td><td class="td-linebottomrt">2048</td><td class="td-linebottomrt">137.524 s</td><td class="td-linebottomrt" class="td-linebottomrt">7.3%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=7 height=10></td></tr><tr><td class="td-linebottomrt">All other lines</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">1016.097 s</td><td class="td-linebottomrt">53.9%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=54 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">1886.797 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><b>Children</b> (called functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="file112.html">repmat</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">24607</td><td class="td-linebottomrt">700.134 s</td><td class="td-linebottomrt">37.1%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=37 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file104.html">histcn</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">3418</td><td class="td-linebottomrt">1.416 s</td><td class="td-linebottomrt">0.1%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file103.html">findNeighbouringSuperpixelIndices</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">3418</td><td class="td-linebottomrt">0.769 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file116.html">sub2ind</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">2048</td><td class="td-linebottomrt">0.112 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file113.html">ind2sub</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">2048</td><td class="td-linebottomrt">0.083 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file109.html">mean</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">1370</td><td class="td-linebottomrt">0.024 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file117.html">median</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">2</td><td class="td-linebottomrt">0.002 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt">Self time (built-ins, overhead, etc.)</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">1184.257 s</td><td class="td-linebottomrt">62.8%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=63 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">1886.797 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><strong>Code Analyzer results</strong><br/>No Code Analyzer messages.<div class="grayline"/><strong>Coverage results</strong><br/>Show coverage for parent directory <br/><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Total lines in function</td><td class="td-linebottomrt">220</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Non-code lines (comments, blank lines)</td><td class="td-linebottomrt">107</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines (lines that can run)</td><td class="td-linebottomrt">113</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did run</td><td class="td-linebottomrt">113</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did not run</td><td class="td-linebottomrt">0</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Coverage (did run/can run)</td><td class="td-linebottomrt">100.00 %</td></tr></table><div class="grayline"/><b>Function listing</b><br/><pre> <span style="color: #FF0000; font-weight: bold; text-decoration: none">  time</span> <span style="color: #0000FF; font-weight: bold; text-decoration: none">  calls</span>  <span style="font-weight: bold; text-decoration: none">line</span><br/>               <span style="color: #A0A0A0">   1</span> <span style="color: #A0A0A0; background: #FFFFFF;">function [spArray, motionSignificanceHistory, saliencySpatial] = populateSpArray(frameNow, framePrev)</span><br/>               <span style="color: #A0A0A0">   2</span> <span style="color: #228B22; background: #FFFFFF;">%POPULATESPARRAY Populates the superpixel array by looping through each superpixel and computing its</span><br/>               <span style="color: #A0A0A0">   3</span> <span style="color: #228B22; background: #FFFFFF;">%histograms and properties</span><br/>               <span style="color: #A0A0A0">   4</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">   5</span> <span style="color: #228B22; background: #FFFFFF;">% motion significance window length</span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold">   6</span> <span style="color: #000000; background: #FFFFFF;">motionSignigicanceWinLength = 5; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold">   7</span> <span style="color: #000000; background: #FFFFFF;">motionSignificanceHistory = []; </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold">   8</span> <span style="color: #000000; background: #FFFFFF;">saliencySpatial = zeros(frameNow.imgSize); </span><br/>               <span style="color: #A0A0A0">   9</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  10</span> <span style="color: #228B22; background: #FFFFFF;">% preallocate spArray</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold">  11</span> <span style="color: #000000; background: #FFFFFF;">spArray = <a href="file112.html">repmat</a>(struct( ... </span><br/>               <span style="color: #A0A0A0">  12</span> <span style="color: #000000; background: #FFFFFF;">    'pixelCount',[], ...</span><br/>               <span style="color: #A0A0A0">  13</span> <span style="color: #000000; background: #FFFFFF;">    'yInds', [], ...</span><br/>               <span style="color: #A0A0A0">  14</span> <span style="color: #000000; background: #FFFFFF;">    'xInds', [], ...</span><br/>               <span style="color: #A0A0A0">  15</span> <span style="color: #000000; background: #FFFFFF;">    'center',[], ...</span><br/>               <span style="color: #A0A0A0">  16</span> <span style="color: #000000; background: #FFFFFF;">    'pixelVals',[], ...</span><br/>               <span style="color: #A0A0A0">  17</span> <span style="color: #000000; background: #FFFFFF;">    'flowVals',[], ...</span><br/>               <span style="color: #A0A0A0">  18</span> <span style="color: #000000; background: #FFFFFF;">    'motionHist',[], ...</span><br/>               <span style="color: #A0A0A0">  19</span> <span style="color: #000000; background: #FFFFFF;">    'colorHist',[], ...</span><br/>               <span style="color: #A0A0A0">  20</span> <span style="color: #000000; background: #FFFFFF;">    'meanMotion',[], ...</span><br/>               <span style="color: #A0A0A0">  21</span> <span style="color: #000000; background: #FFFFFF;">    'interFrameSimilarity', [], ...</span><br/>               <span style="color: #A0A0A0">  22</span> <span style="color: #000000; background: #FFFFFF;">    'saliencyMotionDistinctiveness', [], ...</span><br/>               <span style="color: #A0A0A0">  23</span> <span style="color: #000000; background: #FFFFFF;">    'saliencyTemporalPrediction', [], ...</span><br/>               <span style="color: #A0A0A0">  24</span> <span style="color: #000000; background: #FFFFFF;">    'saliencyTemporal', [], ...</span><br/>               <span style="color: #A0A0A0">  25</span> <span style="color: #000000; background: #FFFFFF;">    'intraFrameSimilarity', zeros(frameNow.spNum, 1), ...</span><br/>               <span style="color: #A0A0A0">  26</span> <span style="color: #000000; background: #FFFFFF;">    'saliencyGlobalContrast', [], ...</span><br/>               <span style="color: #A0A0A0">  27</span> <span style="color: #000000; background: #FFFFFF;">    'saliencySpatialSparcity', [], ...</span><br/>               <span style="color: #A0A0A0">  28</span> <span style="color: #000000; background: #FFFFFF;">    'saliencySpatial', []), frameNow.spNum, 1);</span><br/>               <span style="color: #A0A0A0">  29</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold">  30</span> <span style="color: #000000; background: #FFFFFF;">if frameNow.frameNum ~= 1 </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      2 </span><span style="color: #000000; font-weight: bold">  31</span> <span style="color: #000000; background: #FFFFFF;">    prevCenters = reshape([framePrev.spArray.center], 2, [])'; </span><br/>       <span style="color: #0000FF">      2 </span><span style="color: #000000; font-weight: bold">  32</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0">  33</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  34</span> <span style="color: #228B22; background: #FFFFFF;">% loop through each superpixel</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold">  35</span> <span style="color: #000000; background: #FFFFFF;">for i = 1:frameNow.spNum </span><br/>               <span style="color: #A0A0A0">  36</span> <span style="color: #228B22; background: #FFFFFF;">    % get indices and count</span><br/><span style="color: #FF0000">  0.58 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold">  37</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).pixelInds = find(frameNow.spMap == frameNow.spInds(i)); </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold">  38</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).pixelCount = length(spArray(i).pixelInds); </span><br/>               <span style="color: #A0A0A0">  39</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0">  40</span> <span style="color: #228B22; background: #FFFFFF;">    % compute center</span><br/><span style="color: #FF0000">  0.13 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold">  41</span> <span style="color: #000000; background: #FFFFFF;">    [spArray(i).yInds, spArray(i).xInds] = <a href="file113.html">ind2sub</a>(frameNow.imgSize, spArray(i).pixelInds); </span><br/><span style="color: #FF0000">  0.07 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold">  42</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).center = [sum(spArray(i).yInds)/length(spArray(i).pixelInds) sum(spArray(i).xInds)/length(spArray(i).pixelInds)]; </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold">  43</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).distanceToFrameCenter = norm(spArray(i).center - frameNow.center); </span><br/>               <span style="color: #A0A0A0">  44</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0">  45</span> <span style="color: #228B22; background: #FFFFFF;">    % compute superpixel level color histogram and normalize</span><br/><span style="color: #FF0000">  0.99 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold">  46</span> <span style="color: #000000; background: #FFFFFF;">    [spArray(i).colorHist, ~, ~, spArray(i).colorLoc] = <a href="file104.html">histcn</a>(frameNow.labImg(spArray(i).pixelInds,:), frameNow.colorEdges{1}, frameNow.colorEdges{2}, frameNow.colorEdges{3}); </span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold">  47</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).colorHist = spArray(i).colorHist/sum(spArray(i).colorHist(:)); </span><br/>               <span style="color: #A0A0A0">  48</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0">  49</span> <span style="color: #228B22; background: #FFFFFF;">    % compute superpixel level motion histogram and normalize</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold">  50</span> <span style="color: #000000; background: #FFFFFF;">    if frameNow.frameNum ~= 1 </span><br/><span style="color: #FF0000">  0.53 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold">  51</span> <span style="color: #000000; background: #FFFFFF;">        spArray(i).motionHist = <a href="file104.html">histcn</a>(frameNow.flowPolar(spArray(i).pixelInds,:), frameNow.motionEdgesPolar{1}, frameNow.motionEdgesPolar{2}); </span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold">  52</span> <span style="color: #000000; background: #FFFFFF;">        spArray(i).motionHist = spArray(i).motionHist/sum(spArray(i).motionHist(:)); </span><br/>               <span style="color: #A0A0A0">  53</span> <span style="color: #228B22; background: #FFFFFF;">        </span><br/>               <span style="color: #A0A0A0">  54</span> <span style="color: #228B22; background: #FFFFFF;">        % calculate mean flow of the superpixel</span><br/><span style="color: #FF0000">  0.04 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold">  55</span> <span style="color: #000000; background: #FFFFFF;">        spMeanFlow = <a href="file109.html">mean</a>(frameNow.flowCart(spArray(i).pixelInds,:), 1); </span><br/>               <span style="color: #A0A0A0">  56</span> <span style="color: #228B22; background: #FFFFFF;">        % project the center backwards</span><br/><span style="color: #FF0000">  0.08 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold">  57</span> <span style="color: #000000; background: #FFFFFF;">        projectedCenter = <a href="file112.html">repmat</a>(spArray(i).center - spMeanFlow, framePrev.spNum, 1); </span><br/>               <span style="color: #A0A0A0">  58</span> <span style="color: #228B22; background: #FFFFFF;">        % compute distances between projected center and all previous superpixel centers</span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold">  59</span> <span style="color: #000000; background: #FFFFFF;">        norms = sqrt(sum((projectedCenter - prevCenters).^2, 2)); </span><br/>               <span style="color: #A0A0A0">  60</span> <span style="color: #228B22; background: #FFFFFF;">        % find the closest match</span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold">  61</span> <span style="color: #000000; background: #FFFFFF;">        [~, minSpIndex] = min(norms); </span><br/>               <span style="color: #A0A0A0">  62</span> <span style="color: #228B22; background: #FFFFFF;">        % find neighbouring indices of the most likely superpixel from the previous frame</span><br/><span style="color: #FF0000">  0.39 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold">  63</span> <span style="color: #000000; background: #FFFFFF;">        spArray(i).prevNeighbouringSpInds = <a href="file103.html">findNeighbouringSuperpixelIndices</a>(minSpIndex, framePrev, []); </span><br/>               <span style="color: #A0A0A0">  64</span> <span style="color: #228B22; background: #FFFFFF;">        % calculate interframe similarity between current superpixel and each neighbour</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold">  65</span> <span style="color: #000000; background: #FFFFFF;">        spArray(i).interFrameSimilarity = zeros(length(spArray(i).prevNeighbouringSpInds), 1); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold">  66</span> <span style="color: #000000; background: #FFFFFF;">        currSp = spArray(i); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold">  67</span> <span style="color: #000000; background: #FFFFFF;">        for j = 1:length(spArray(i).prevNeighbouringSpInds) </span><br/><span style="color: #FF0000">  0.07 </span><span style="color: #0000FF">   7815 </span><span style="color: #000000; font-weight: bold">  68</span> <span style="color: #000000; background: #FFFFFF;">            prevSp = framePrev.spArray(spArray(i).prevNeighbouringSpInds(j)); </span><br/><span style="color: #FF0000">  0.65 </span><span style="color: #0000FF">   7815 </span><span style="color: #000000; font-weight: bold">  69</span> <span style="color: #000000; background: #FFFFFF;">            spArray(i).interFrameSimilarity(j) = sum(sqrt(currSp.colorHist(:) .* prevSp.colorHist(:))) * ... </span><br/>               <span style="color: #A0A0A0">  70</span> <span style="color: #000000; background: #FFFFFF;">                (1 - norm(currSp.center - spMeanFlow - prevSp.center)/framePrev.diagonal);</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   7815 </span><span style="color: #000000; font-weight: bold">  71</span> <span style="color: #000000; background: #FFFFFF;">        end </span><br/>       <span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold">  72</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold">  73</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0">  74</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold">  75</span> <span style="color: #000000; background: #FFFFFF;">distancesToFrameCenter = [spArray.distanceToFrameCenter]'; </span><br/>               <span style="color: #A0A0A0">  76</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  77</span> <span style="color: #228B22; background: #FFFFFF;">% frameNow.spNum ~ 700</span><br/>               <span style="color: #A0A0A0">  78</span> <span style="color: #228B22; background: #FFFFFF;">% frameNow.contrastBinCount = 16 (per channel)</span><br/>               <span style="color: #A0A0A0">  79</span> <span style="color: #228B22; background: #FFFFFF;">% frameNow.colorMean = 4096x3 (mean color for each bin)</span><br/>               <span style="color: #A0A0A0">  80</span> <span style="color: #228B22; background: #FFFFFF;">% frameNow.colorHist = 16x16x16 (global histogram counts)</span><br/>               <span style="color: #A0A0A0">  81</span> <span style="color: #228B22; background: #FFFFFF;">% spArray(i).colorHist = 16x16x16 (superpixel histogram counts)</span><br/>               <span style="color: #A0A0A0">  82</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold">  83</span> <span style="color: #000000; background: #FFFFFF;">for i = 1:frameNow.spNum </span><br/>               <span style="color: #A0A0A0">  84</span> <span style="color: #228B22; background: #FFFFFF;">    % calculate global contrast (slow)</span><br/>               <span style="color: #A0A0A0">  85</span> <span style="color: #228B22; background: #FFFFFF;">%     disp('unvectorized');</span><br/>               <span style="color: #A0A0A0">  86</span> <span style="color: #228B22; background: #FFFFFF;">%     unvectorized = tic;</span><br/>               <span style="color: #A0A0A0">  87</span> <span style="color: #228B22; background: #FFFFFF;">%     spArray(i).saliencyGlobalContrast = 0;</span><br/>               <span style="color: #A0A0A0">  88</span> <span style="color: #228B22; background: #FFFFFF;">%     for j = 1:frameNow.contrastBinCount^3</span><br/>               <span style="color: #A0A0A0">  89</span> <span style="color: #228B22; background: #FFFFFF;">%         innerSum = 0;</span><br/>               <span style="color: #A0A0A0">  90</span> <span style="color: #228B22; background: #FFFFFF;">%         for k = 1:frameNow.contrastBinCount^3</span><br/>               <span style="color: #A0A0A0">  91</span> <span style="color: #228B22; background: #FFFFFF;">%             innerSum = innerSum + norm(frameNow.colorMean(j,:) - frameNow.colorMean(k,:)) * frameNow.colorHist(k);</span><br/>               <span style="color: #A0A0A0">  92</span> <span style="color: #228B22; background: #FFFFFF;">%         end</span><br/>               <span style="color: #A0A0A0">  93</span> <span style="color: #228B22; background: #FFFFFF;">%         spArray(i).saliencyGlobalContrast = spArray(i).saliencyGlobalContrast + (spArray(i).colorHist(j) * innerSum);</span><br/>               <span style="color: #A0A0A0">  94</span> <span style="color: #228B22; background: #FFFFFF;">%     end</span><br/>               <span style="color: #A0A0A0">  95</span> <span style="color: #228B22; background: #FFFFFF;">%     toc(unvectorized);</span><br/>               <span style="color: #A0A0A0">  96</span> <span style="color: #228B22; background: #FFFFFF;">    % Elapsed time is 21.300789 seconds.</span><br/>               <span style="color: #A0A0A0">  97</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0">  98</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0">  99</span> <span style="color: #228B22; background: #FFFFFF;">    % calculate global contrast</span><br/>               <span style="color: #A0A0A0"> 100</span> <span style="color: #228B22; background: #FFFFFF;">    % vectorized form of the global contrast saliency calculation. It flattens out the double loop</span><br/>               <span style="color: #A0A0A0"> 101</span> <span style="color: #228B22; background: #FFFFFF;">    % into large q^3 x q^3 matrices, computes the inner sum for all combinations of j and k,</span><br/>               <span style="color: #A0A0A0"> 102</span> <span style="color: #228B22; background: #FFFFFF;">    % multiplies each value by the corresponding global contrast bin count at k, sums that value, and</span><br/>               <span style="color: #A0A0A0"> 103</span> <span style="color: #228B22; background: #FFFFFF;">    % then does the outer j sum and multiply with the superpixel color bin count. Higher memory</span><br/>               <span style="color: #A0A0A0"> 104</span> <span style="color: #228B22; background: #FFFFFF;">    % requirement but much, much faster. ~20x faster!</span><br/><span style="color: #FF0000">  1.23 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 105</span> <span style="color: #000000; background: #FFFFFF;">    disp('matrices'); </span><br/><span style="color: #FF0000">  0.04 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 106</span> <span style="color: #000000; background: #FFFFFF;">    matrices = tic; </span><br/><span style="color: #FF0000"> 138.37 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 107</span> <a name="Line107"></a><span style="color: #000000; background: #FFC6C6;">    color_l1 = <a href="file112.html">repmat</a>(frameNow.colorMean(:,1), 1, frameNow.contrastBinCount^3); </span><br/><span style="color: #FF0000"> 135.00 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 108</span> <span style="color: #000000; background: #FFC6C6;">    color_l2 = <a href="file112.html">repmat</a>(frameNow.colorMean(:,1)', frameNow.contrastBinCount^3, 1); </span><br/><span style="color: #FF0000"> 129.60 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 109</span> <span style="color: #000000; background: #FFC6C6;">    color_a1 = <a href="file112.html">repmat</a>(frameNow.colorMean(:,2), 1, frameNow.contrastBinCount^3); </span><br/><span style="color: #FF0000"> 131.10 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 110</span> <span style="color: #000000; background: #FFC6C6;">    color_a2 = <a href="file112.html">repmat</a>(frameNow.colorMean(:,2)', frameNow.contrastBinCount^3, 1); </span><br/><span style="color: #FF0000"> 128.38 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 111</span> <span style="color: #000000; background: #FFC6C6;">    color_b1 = <a href="file112.html">repmat</a>(frameNow.colorMean(:,3), 1, frameNow.contrastBinCount^3); </span><br/><span style="color: #FF0000"> 130.95 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 112</span> <span style="color: #000000; background: #FFC6C6;">    color_b2 = <a href="file112.html">repmat</a>(frameNow.colorMean(:,3)', frameNow.contrastBinCount^3, 1); </span><br/>               <span style="color: #A0A0A0"> 113</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/><span style="color: #FF0000"> 136.81 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 114</span> <span style="color: #000000; background: #FFC6C6;">    color_l_diff = color_l1 - color_l2; </span><br/><span style="color: #FF0000"> 137.52 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 115</span> <a name="Line115"></a><span style="color: #000000; background: #FFC6C6;">    color_a_diff = color_a1 - color_a2; </span><br/><span style="color: #FF0000"> 138.35 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 116</span> <a name="Line116"></a><span style="color: #000000; background: #FFC6C6;">    color_b_diff = color_b1 - color_b2; </span><br/>               <span style="color: #A0A0A0"> 117</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/><span style="color: #FF0000"> 294.68 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 118</span> <a name="Line118"></a><span style="color: #000000; background: #FF8080;">    color_norm = sqrt(color_l_diff.^2 + color_a_diff.^2 + color_b_diff.^2); </span><br/>               <span style="color: #A0A0A0"> 119</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/><span style="color: #FF0000"> 131.58 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 120</span> <span style="color: #000000; background: #FFC6C6;">    globalColorHist = <a href="file112.html">repmat</a>(frameNow.colorHist(:), 1, frameNow.contrastBinCount^3); </span><br/><span style="color: #FF0000"> 161.78 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 121</span> <a name="Line121"></a><span style="color: #000000; background: #FFB8B8;">    innerSum = sum(color_norm.*globalColorHist, 1); </span><br/><span style="color: #FF0000">  0.20 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 122</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).saliencyGlobalContrast = spArray(i).colorHist(:)'*innerSum'; </span><br/><span style="color: #FF0000">  0.49 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 123</span> <span style="color: #000000; background: #FFFFFF;">    toc(matrices); </span><br/>               <span style="color: #A0A0A0"> 124</span> <span style="color: #228B22; background: #FFFFFF;">    % Elapsed time is 1.032221 seconds.</span><br/>               <span style="color: #A0A0A0"> 125</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0"> 126</span> <span style="color: #228B22; background: #FFFFFF;">    % TODO: see if I can't vectorize this better, just worried about memory constraints:</span><br/>               <span style="color: #A0A0A0"> 127</span> <span style="color: #228B22; background: #FFFFFF;">    % 700x700x4096 * 2 for the first term...</span><br/><span style="color: #FF0000">  1.77 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 128</span> <span style="color: #000000; background: #FFFFFF;">    disp('loop'); </span><br/><span style="color: #FF0000">  0.04 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 129</span> <span style="color: #000000; background: #FFFFFF;">    loop = tic; </span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 130</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).intraFrameSimilarity = zeros(frameNow.spNum, 1); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 131</span> <span style="color: #000000; background: #FFFFFF;">    for j = 1:frameNow.spNum </span><br/><span style="color: #FF0000"> 81.40 </span><span style="color: #0000FF">1398142 </span><span style="color: #000000; font-weight: bold"> 132</span> <span style="color: #000000; background: #FFE2E2;">        spArray(i).intraFrameSimilarity(j) = sum(sqrt(spArray(i).colorHist(:) .* spArray(j).colorHist(:))) * ... </span><br/>               <span style="color: #A0A0A0"> 133</span> <span style="color: #000000; background: #FFE2E2;">            (1 - norm(spArray(i).center - spArray(j).center)/frameNow.diagonal);</span><br/><span style="color: #FF0000">  0.39 </span><span style="color: #0000FF">1398142 </span><span style="color: #000000; font-weight: bold"> 134</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>               <span style="color: #A0A0A0"> 135</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 136</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).colorSpatialDistribution = sum(spArray(i).intraFrameSimilarity.*distancesToFrameCenter)/sum(spArray(i).intraFrameSimilarity); </span><br/><span style="color: #FF0000">  0.27 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 137</span> <span style="color: #000000; background: #FFFFFF;">    toc(loop); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 138</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 139</span> <span style="color: #000000; background: #FFFFFF;">toc </span><br/>               <span style="color: #A0A0A0"> 140</span> <span style="color: #228B22; background: #FFFFFF;">% calculate saliencySpatialSparcity and saliencySpatial</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 141</span> <span style="color: #000000; background: #FFFFFF;">maxColorSpatialDistribution = max([spArray.colorSpatialDistribution]); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 142</span> <span style="color: #000000; background: #FFFFFF;">minColorSpatialDistribution = min([spArray.colorSpatialDistribution]); </span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 143</span> <span style="color: #000000; background: #FFFFFF;">for i = 1:frameNow.spNum </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 144</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).saliencySpatialSparcity = (maxColorSpatialDistribution - spArray(i).colorSpatialDistribution)/(maxColorSpatialDistribution - minColorSpatialDistribution); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 145</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).saliencySpatial = spArray(i).saliencySpatialSparcity * spArray(i).saliencyGlobalContrast; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 146</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 147</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 148</span> <span style="color: #000000; background: #FFFFFF;">for i = 1:frameNow.spNum </span><br/>               <span style="color: #A0A0A0"> 149</span> <span style="color: #228B22; background: #FFFFFF;">    % find neighbour indices for each superpixel in the current frame</span><br/><span style="color: #FF0000">  0.41 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 150</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).nowNeighbouringSpInds = <a href="file103.html">findNeighbouringSuperpixelIndices</a>(i, frameNow, spArray); </span><br/>               <span style="color: #A0A0A0"> 151</span> <span style="color: #228B22; background: #FFFFFF;">    % get the bin indices of each pixel in the superpixel</span><br/><span style="color: #FF0000">  0.19 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 152</span> <span style="color: #000000; background: #FFFFFF;">    colorBinInds = <a href="file116.html">sub2ind</a>(<a href="file112.html">repmat</a>(frameNow.contrastBinCount, 1, 3), spArray(i).colorLoc(:,1), spArray(i).colorLoc(:,2), spArray(i).colorLoc(:,3)); </span><br/>               <span style="color: #A0A0A0"> 153</span> <span style="color: #228B22; background: #FFFFFF;">    % compute the pixel-level spatial saliency score for each pixel in the superpixel</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 154</span> <span style="color: #000000; background: #FFFFFF;">    numeratorSum = zeros(spArray(i).pixelCount, 1); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 155</span> <span style="color: #000000; background: #FFFFFF;">    denomenatorSum = zeros(spArray(i).pixelCount, 1); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 156</span> <span style="color: #000000; background: #FFFFFF;">    for j = 1:length(spArray(i).nowNeighbouringSpInds) </span><br/><span style="color: #FF0000">  0.06 </span><span style="color: #0000FF">  11467 </span><span style="color: #000000; font-weight: bold"> 157</span> <span style="color: #000000; background: #FFFFFF;">        numeratorSum = numeratorSum + (spArray(j).saliencySpatial * spArray(j).colorHist(colorBinInds)); </span><br/><span style="color: #FF0000">  0.04 </span><span style="color: #0000FF">  11467 </span><span style="color: #000000; font-weight: bold"> 158</span> <span style="color: #000000; background: #FFFFFF;">        denomenatorSum = denomenatorSum + spArray(j).colorHist(colorBinInds); </span><br/>       <span style="color: #0000FF">  11467 </span><span style="color: #000000; font-weight: bold"> 159</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 160</span> <span style="color: #000000; background: #FFFFFF;">    saliencySpatial(spArray(i).pixelInds) = numeratorSum./denomenatorSum; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   2048 </span><span style="color: #000000; font-weight: bold"> 161</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 162</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 163</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 164</span> <span style="color: #000000; background: #FFFFFF;">if frameNow.frameNum ~= 1 </span><br/>               <span style="color: #A0A0A0"> 165</span> <span style="color: #228B22; background: #FFFFFF;">    % calculate motion distinctiveness</span><br/>               <span style="color: #A0A0A0"> 166</span> <span style="color: #228B22; background: #FFFFFF;">    % vectorized form of the motion distinctiveness calculation. It flattens out the double loop</span><br/>               <span style="color: #A0A0A0"> 167</span> <span style="color: #228B22; background: #FFFFFF;">    % into large q^2 x q^2 matrices, computes the inner sum for all combinations of j and k,</span><br/>               <span style="color: #A0A0A0"> 168</span> <span style="color: #228B22; background: #FFFFFF;">    % multiplies each value by the correspoing global motion bin count at k, sums that value, and</span><br/>               <span style="color: #A0A0A0"> 169</span> <span style="color: #228B22; background: #FFFFFF;">    % then does the outer j sum and multiply with the superpixel motion bin count. Higher memory</span><br/>               <span style="color: #A0A0A0"> 170</span> <span style="color: #228B22; background: #FFFFFF;">    % requirement but much, much faster.</span><br/>       <span style="color: #0000FF">      2 </span><span style="color: #000000; font-weight: bold"> 171</span> <span style="color: #000000; background: #FFFFFF;">    for i = 1:frameNow.spNum </span><br/><span style="color: #FF0000">  0.12 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold"> 172</span> <span style="color: #000000; background: #FFFFFF;">        flow_u1 = <a href="file112.html">repmat</a>(frameNow.motionMeanCart(:,1), 1, frameNow.motionBinCount^2); </span><br/><span style="color: #FF0000">  0.10 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold"> 173</span> <span style="color: #000000; background: #FFFFFF;">        flow_u2 = <a href="file112.html">repmat</a>(frameNow.motionMeanCart(:,1)', frameNow.motionBinCount^2, 1); </span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold"> 174</span> <span style="color: #000000; background: #FFFFFF;">        flow_v1 = <a href="file112.html">repmat</a>(frameNow.motionMeanCart(:,2), 1, frameNow.motionBinCount^2); </span><br/><span style="color: #FF0000">  0.12 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold"> 175</span> <span style="color: #000000; background: #FFFFFF;">        flow_v2 = <a href="file112.html">repmat</a>(frameNow.motionMeanCart(:,2)', frameNow.motionBinCount^2, 1); </span><br/>               <span style="color: #A0A0A0"> 176</span> <span style="color: #228B22; background: #FFFFFF;">        </span><br/><span style="color: #FF0000">  0.14 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold"> 177</span> <span style="color: #000000; background: #FFFFFF;">        flow_u_diff = flow_u1 - flow_u2; </span><br/><span style="color: #FF0000">  0.15 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold"> 178</span> <span style="color: #000000; background: #FFFFFF;">        flow_v_diff = flow_v1 - flow_v2; </span><br/>               <span style="color: #A0A0A0"> 179</span> <span style="color: #228B22; background: #FFFFFF;">        </span><br/><span style="color: #FF0000">  0.48 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold"> 180</span> <span style="color: #000000; background: #FFFFFF;">        flow_norm = sqrt(flow_u_diff.^2 + flow_v_diff.^2); </span><br/>               <span style="color: #A0A0A0"> 181</span> <span style="color: #228B22; background: #FFFFFF;">        </span><br/><span style="color: #FF0000">  0.15 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold"> 182</span> <span style="color: #000000; background: #FFFFFF;">        globalMotionHist = <a href="file112.html">repmat</a>(frameNow.motionHist(:), 1, frameNow.motionBinCount^2); </span><br/><span style="color: #FF0000">  0.24 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold"> 183</span> <span style="color: #000000; background: #FFFFFF;">        innerSum = sum(flow_norm.*globalMotionHist, 1); </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold"> 184</span> <span style="color: #000000; background: #FFFFFF;">        spArray(i).saliencyMotionDistinctiveness = spArray(i).motionHist(:)'*innerSum'; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold"> 185</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>               <span style="color: #A0A0A0"> 186</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0"> 187</span> <span style="color: #228B22; background: #FFFFFF;">    % calculate motion significance</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      2 </span><span style="color: #000000; font-weight: bold"> 188</span> <span style="color: #000000; background: #FFFFFF;">    motionSignificance = sum([spArray.saliencyMotionDistinctiveness].*[spArray.pixelCount]); </span><br/>       <span style="color: #0000FF">      2 </span><span style="color: #000000; font-weight: bold"> 189</span> <span style="color: #000000; background: #FFFFFF;">    if frameNow.frameNum == 2 </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 190</span> <span style="color: #000000; background: #FFFFFF;">        motionSignificanceHistory = motionSignificance; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 191</span> <span style="color: #228B22; background: #FFFFFF;">    else </span><br/>               <span style="color: #A0A0A0"> 192</span> <span style="color: #228B22; background: #FFFFFF;">        % calculate the adjustment weight based on motion significance for each frame</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 193</span> <span style="color: #000000; background: #FFFFFF;">        adjustmentWeight = max(<a href="file117.html">median</a>(framePrev.motionSignificanceHistory)/(<a href="file117.html">median</a>(framePrev.motionSignificanceHistory) + motionSignificance), 0.5); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 194</span> <span style="color: #000000; background: #FFFFFF;">        motionSignificanceHistory = [framePrev.motionSignificanceHistory motionSignificance]; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 195</span> <span style="color: #000000; background: #FFFFFF;">        motionSignificanceHistory = motionSignificanceHistory(max(length(motionSignificanceHistory)- motionSignigicanceWinLength, 1):end); </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 196</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>               <span style="color: #A0A0A0"> 197</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0"> 198</span> <span style="color: #228B22; background: #FFFFFF;">    % TODO: double loop, see if I can't collapse it/vectorize it</span><br/>       <span style="color: #0000FF">      2 </span><span style="color: #000000; font-weight: bold"> 199</span> <span style="color: #000000; background: #FFFFFF;">    for i = 1:frameNow.spNum </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold"> 200</span> <span style="color: #000000; background: #FFFFFF;">        if frameNow.frameNum == 2 </span><br/>               <span style="color: #A0A0A0"> 201</span> <span style="color: #228B22; background: #FFFFFF;">            % no previous saliency value on first motion frame, just use motion distinctiveness</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    683 </span><span style="color: #000000; font-weight: bold"> 202</span> <span style="color: #000000; background: #FFFFFF;">            spArray(i).saliencyTemporal = spArray(i).saliencyMotionDistinctiveness; </span><br/>       <span style="color: #0000FF">    687 </span><span style="color: #000000; font-weight: bold"> 203</span> <span style="color: #228B22; background: #FFFFFF;">        else </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    687 </span><span style="color: #000000; font-weight: bold"> 204</span> <span style="color: #000000; background: #FFFFFF;">            if sum(spArray(i).interFrameSimilarity) &gt; 0 </span><br/>               <span style="color: #A0A0A0"> 205</span> <span style="color: #228B22; background: #FFFFFF;">                % calculate temporal saliency prediction</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    685 </span><span style="color: #000000; font-weight: bold"> 206</span> <span style="color: #000000; background: #FFFFFF;">                prevTemporalSaliency = [framePrev.spArray(spArray(i).prevNeighbouringSpInds).saliencyTemporal]'; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    685 </span><span style="color: #000000; font-weight: bold"> 207</span> <span style="color: #000000; background: #FFFFFF;">                spArray(i).saliencyTemporalPrediction = sum(spArray(i).interFrameSimilarity.*prevTemporalSaliency)/sum(spArray(i).interFrameSimilarity); </span><br/>               <span style="color: #A0A0A0"> 208</span> <span style="color: #228B22; background: #FFFFFF;">                </span><br/>               <span style="color: #A0A0A0"> 209</span> <span style="color: #228B22; background: #FFFFFF;">                % calculate temporal saliency by adjustment</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    685 </span><span style="color: #000000; font-weight: bold"> 210</span> <span style="color: #000000; background: #FFFFFF;">                spArray(i).saliencyTemporal = adjustmentWeight*spArray(i).saliencyTemporalPrediction + ... </span><br/>               <span style="color: #A0A0A0"> 211</span> <span style="color: #000000; background: #FFFFFF;">                    (1 - adjustmentWeight)*spArray(i).saliencyMotionDistinctiveness;</span><br/>       <span style="color: #0000FF">      2 </span><span style="color: #000000; font-weight: bold"> 212</span> <span style="color: #228B22; background: #FFFFFF;">            else </span><br/>       <span style="color: #0000FF">      2 </span><span style="color: #000000; font-weight: bold"> 213</span> <span style="color: #000000; background: #FFFFFF;">                spArray(i).saliencyTemporalPrediction = 0; </span><br/>       <span style="color: #0000FF">      2 </span><span style="color: #000000; font-weight: bold"> 214</span> <span style="color: #000000; background: #FFFFFF;">                spArray(i).saliencyTemporal = spArray(i).saliencyMotionDistinctiveness; </span><br/>       <span style="color: #0000FF">      2 </span><span style="color: #000000; font-weight: bold"> 215</span> <span style="color: #000000; background: #FFFFFF;">            end </span><br/>       <span style="color: #0000FF">    687 </span><span style="color: #000000; font-weight: bold"> 216</span> <span style="color: #000000; background: #FFFFFF;">        end </span><br/>       <span style="color: #0000FF">   1370 </span><span style="color: #000000; font-weight: bold"> 217</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/>       <span style="color: #0000FF">      2 </span><span style="color: #000000; font-weight: bold"> 218</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 219</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">      3 </span><span style="color: #000000; font-weight: bold"> 220</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/></pre><p><p>Other subfunctions in this file are not included in this listing.</body></html>