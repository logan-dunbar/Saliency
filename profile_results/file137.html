<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252" /><link rel="stylesheet" href="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\matlab-report-styles.css" type="text/css" /><title>Function details for populateSpArray</title><link rel="stylesheet" href="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\matlab-report-styles.css" type="text/css" /></head><body bgcolor="#F8F8F8"><strong>This is a static copy of a profile report</strong><p><a href="file0.html">Home</a><p><span style="font-size:14pt; background:#FFE4B0">populateSpArray (2 calls, 687.386 sec)</span><br/><i>Generated 26-Dec-2014 11:50:54 using cpu time.</i><br/>function in file D:\Logan\Documents\MATLAB\Saliency\populateSpArray.m<br/>Copy to new window for comparing multiple runs<p><span class="warning">This function changed during profiling or before generation of this report. Results may be incomplete or inaccurate.</span></p><div class="grayline"/><div class="grayline"/><strong>Parents</strong> (calling functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td></tr><tr><td class="td-linebottomrt"><a href="file119.html">populateFrame</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">2</td></tr></table><div class="grayline"/><strong>Lines where the most time was spent</strong><br/> <p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Line Number</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Code</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="#Line106">106</a></td><td class="td-linebottomrt"><pre>color_a_diff = color_a1 - colo...</pre></td><td class="td-linebottomrt">678</td><td class="td-linebottomrt">101.316 s</td><td class="td-linebottomrt" class="td-linebottomrt">14.7%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=15 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line108">108</a></td><td class="td-linebottomrt"><pre></pre></td><td class="td-linebottomrt">678</td><td class="td-linebottomrt">62.582 s</td><td class="td-linebottomrt" class="td-linebottomrt">9.1%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=9 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line102">102</a></td><td class="td-linebottomrt"><pre>color_b1 = repmat(frameNow.col...</pre></td><td class="td-linebottomrt">678</td><td class="td-linebottomrt">53.452 s</td><td class="td-linebottomrt" class="td-linebottomrt">7.8%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=8 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line103">103</a></td><td class="td-linebottomrt"><pre>color_b2 = repmat(frameNow.col...</pre></td><td class="td-linebottomrt">678</td><td class="td-linebottomrt">53.319 s</td><td class="td-linebottomrt" class="td-linebottomrt">7.8%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=8 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line104">104</a></td><td class="td-linebottomrt"><pre></pre></td><td class="td-linebottomrt">678</td><td class="td-linebottomrt">53.080 s</td><td class="td-linebottomrt" class="td-linebottomrt">7.7%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=8 height=10></td></tr><tr><td class="td-linebottomrt">All other lines</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">363.636 s</td><td class="td-linebottomrt">52.9%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=53 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">687.386 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><b>Children</b> (called functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="file141.html">repmat</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">5427</td><td class="td-linebottomrt">254.337 s</td><td class="td-linebottomrt">37.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=37 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file133.html">histcn</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">680</td><td class="td-linebottomrt">0.235 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file132.html">findNeighbouringSuperpixelIndices</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">679</td><td class="td-linebottomrt">0.167 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file145.html">sub2ind</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">678</td><td class="td-linebottomrt">0.033 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file142.html">ind2sub</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">679</td><td class="td-linebottomrt">0.025 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file138.html">mean</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">1</td><td class="td-linebottomrt">0 s</td><td class="td-linebottomrt">0%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt">Self time (built-ins, overhead, etc.)</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">432.589 s</td><td class="td-linebottomrt">62.9%</td><td class="td-linebottomrt"><img src="file:///C:\Program Files\MATLAB\R2013a\toolbox\matlab\codetools\private\one-pixel.gif" width=63 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">687.386 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><strong>Code Analyzer results</strong><br/>No Code Analyzer messages.<div class="grayline"/><strong>Coverage results</strong><br/>Show coverage for parent directory <br/><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Total lines in function</td><td class="td-linebottomrt">209</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Non-code lines (comments, blank lines)</td><td class="td-linebottomrt">85</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines (lines that can run)</td><td class="td-linebottomrt">124</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did run</td><td class="td-linebottomrt">71</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did not run</td><td class="td-linebottomrt">68</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Coverage (did run/can run)</td><td class="td-linebottomrt">57.26 %</td></tr></table><div class="grayline"/><b>Function listing</b><br/><pre> <span style="color: #FF0000; font-weight: bold; text-decoration: none">  time</span> <span style="color: #0000FF; font-weight: bold; text-decoration: none">  calls</span>  <span style="font-weight: bold; text-decoration: none">line</span><br/>               <span style="color: #A0A0A0">   1</span> <span style="color: #A0A0A0; background: #FFFFFF;">function [spArray, motionSignificanceHistory, saliencySpatial] = populateSpArray(frameNow, framePrev)</span><br/>               <span style="color: #A0A0A0">   2</span> <span style="color: #228B22; background: #FFFFFF;">%POPULATESPARRAY Populates the superpixel array by looping through each superpixel and computing its</span><br/>               <span style="color: #A0A0A0">   3</span> <span style="color: #228B22; background: #FFFFFF;">%histograms and properties</span><br/>               <span style="color: #A0A0A0">   4</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">   5</span> <span style="color: #228B22; background: #FFFFFF;">% motion significance window length</span><br/>       <span style="color: #0000FF">      2 </span><span style="color: #000000; font-weight: bold">   6</span> <span style="color: #000000; background: #FFFFFF;">motionSignigicanceWinLength = 5; </span><br/>       <span style="color: #0000FF">      2 </span><span style="color: #000000; font-weight: bold">   7</span> <span style="color: #000000; background: #FFFFFF;">motionSignificanceHistory = []; </span><br/>       <span style="color: #0000FF">      2 </span><span style="color: #000000; font-weight: bold">   8</span> <span style="color: #000000; background: #FFFFFF;">saliencySpatial = zeros(frameNow.imgSize); </span><br/>               <span style="color: #A0A0A0">   9</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  10</span> <span style="color: #228B22; background: #FFFFFF;">% preallocate spArray</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      2 </span><span style="color: #000000; font-weight: bold">  11</span> <span style="color: #000000; background: #FFFFFF;">spArray = <a href="file141.html">repmat</a>(struct( ... </span><br/>               <span style="color: #A0A0A0">  12</span> <span style="color: #000000; background: #FFFFFF;">    'pixelCount',[], ...</span><br/>               <span style="color: #A0A0A0">  13</span> <span style="color: #000000; background: #FFFFFF;">    'yInds', [], ...</span><br/>               <span style="color: #A0A0A0">  14</span> <span style="color: #000000; background: #FFFFFF;">    'xInds', [], ...</span><br/>               <span style="color: #A0A0A0">  15</span> <span style="color: #000000; background: #FFFFFF;">    'center',[], ...</span><br/>               <span style="color: #A0A0A0">  16</span> <span style="color: #000000; background: #FFFFFF;">    'pixelVals',[], ...</span><br/>               <span style="color: #A0A0A0">  17</span> <span style="color: #000000; background: #FFFFFF;">    'flowVals',[], ...</span><br/>               <span style="color: #A0A0A0">  18</span> <span style="color: #000000; background: #FFFFFF;">    'motionHist',[], ...</span><br/>               <span style="color: #A0A0A0">  19</span> <span style="color: #000000; background: #FFFFFF;">    'colorHist',[], ...</span><br/>               <span style="color: #A0A0A0">  20</span> <span style="color: #000000; background: #FFFFFF;">    'meanMotion',[], ...</span><br/>               <span style="color: #A0A0A0">  21</span> <span style="color: #000000; background: #FFFFFF;">    'interFrameSimilarity', [], ...</span><br/>               <span style="color: #A0A0A0">  22</span> <span style="color: #000000; background: #FFFFFF;">    'saliencyMotionDistinctiveness', [], ...</span><br/>               <span style="color: #A0A0A0">  23</span> <span style="color: #000000; background: #FFFFFF;">    'saliencyTemporalPrediction', [], ...</span><br/>               <span style="color: #A0A0A0">  24</span> <span style="color: #000000; background: #FFFFFF;">    'saliencyTemporal', [], ...</span><br/>               <span style="color: #A0A0A0">  25</span> <span style="color: #000000; background: #FFFFFF;">    'intraFrameSimilarity', zeros(frameNow.spNum, 1), ...</span><br/>               <span style="color: #A0A0A0">  26</span> <span style="color: #000000; background: #FFFFFF;">    'saliencyGlobalContrast', [], ...</span><br/>               <span style="color: #A0A0A0">  27</span> <span style="color: #000000; background: #FFFFFF;">    'saliencySpatialSparcity', [], ...</span><br/>               <span style="color: #A0A0A0">  28</span> <span style="color: #000000; background: #FFFFFF;">    'saliencySpatial', []), frameNow.spNum, 1);</span><br/>               <span style="color: #A0A0A0">  29</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">      2 </span><span style="color: #000000; font-weight: bold">  30</span> <span style="color: #000000; background: #FFFFFF;">if frameNow.frameNum ~= 1 </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  31</span> <span style="color: #000000; background: #FFFFFF;">    prevCenters = reshape([framePrev.spArray.center], 2, [])'; </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  32</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0">  33</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  34</span> <span style="color: #228B22; background: #FFFFFF;">% loop through each superpixel</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      2 </span><span style="color: #000000; font-weight: bold">  35</span> <span style="color: #000000; background: #FFFFFF;">for i = 1:frameNow.spNum </span><br/>               <span style="color: #A0A0A0">  36</span> <span style="color: #228B22; background: #FFFFFF;">    % get indices and count</span><br/><span style="color: #FF0000">  0.16 </span><span style="color: #0000FF">    679 </span><span style="color: #000000; font-weight: bold">  37</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).pixelInds = find(frameNow.spMap == frameNow.spInds(i)); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    679 </span><span style="color: #000000; font-weight: bold">  38</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).pixelCount = length(spArray(i).pixelInds); </span><br/>               <span style="color: #A0A0A0">  39</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0">  40</span> <span style="color: #228B22; background: #FFFFFF;">    % compute center</span><br/><span style="color: #FF0000">  0.04 </span><span style="color: #0000FF">    679 </span><span style="color: #000000; font-weight: bold">  41</span> <span style="color: #000000; background: #FFFFFF;">    [spArray(i).yInds, spArray(i).xInds] = <a href="file142.html">ind2sub</a>(frameNow.imgSize, spArray(i).pixelInds); </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">    679 </span><span style="color: #000000; font-weight: bold">  42</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).center = [sum(spArray(i).yInds)/length(spArray(i).pixelInds) sum(spArray(i).xInds)/length(spArray(i).pixelInds)]; </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    679 </span><span style="color: #000000; font-weight: bold">  43</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).distanceToFrameCenter = norm(spArray(i).center - frameNow.center); </span><br/>               <span style="color: #A0A0A0">  44</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0">  45</span> <span style="color: #228B22; background: #FFFFFF;">    % compute superpixel level color histogram and normalize</span><br/><span style="color: #FF0000">  0.26 </span><span style="color: #0000FF">    679 </span><span style="color: #000000; font-weight: bold">  46</span> <span style="color: #000000; background: #FFFFFF;">    [spArray(i).colorHist, ~, ~, spArray(i).colorLoc] = <a href="file133.html">histcn</a>(frameNow.labImg(spArray(i).pixelInds,:), frameNow.colorEdges{1}, frameNow.colorEdges{2}, frameNow.colorEdges{3}); </span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">    679 </span><span style="color: #000000; font-weight: bold">  47</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).colorHist = spArray(i).colorHist/sum(spArray(i).colorHist(:)); </span><br/>               <span style="color: #A0A0A0">  48</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0">  49</span> <span style="color: #228B22; background: #FFFFFF;">    % compute superpixel level motion histogram and normalize</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    679 </span><span style="color: #000000; font-weight: bold">  50</span> <span style="color: #000000; background: #FFFFFF;">    if frameNow.frameNum ~= 1 </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  51</span> <span style="color: #000000; background: #FFFFFF;">        spArray(i).motionHist = <a href="file133.html">histcn</a>(frameNow.flowPolar(spArray(i).pixelInds,:), frameNow.motionEdgesPolar{1}, frameNow.motionEdgesPolar{2}); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  52</span> <span style="color: #000000; background: #FFFFFF;">        spArray(i).motionHist = spArray(i).motionHist/sum(spArray(i).motionHist(:)); </span><br/>               <span style="color: #A0A0A0">  53</span> <span style="color: #228B22; background: #FFFFFF;">        </span><br/>               <span style="color: #A0A0A0">  54</span> <span style="color: #228B22; background: #FFFFFF;">        % calculate mean flow of the superpixel</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  55</span> <span style="color: #000000; background: #FFFFFF;">        spMeanFlow = <a href="file138.html">mean</a>(frameNow.flowCart(spArray(i).pixelInds,:), 1); </span><br/>               <span style="color: #A0A0A0">  56</span> <span style="color: #228B22; background: #FFFFFF;">        % project the center backwards</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  57</span> <span style="color: #000000; background: #FFFFFF;">        projectedCenter = <a href="file141.html">repmat</a>(spArray(i).center - spMeanFlow, framePrev.spNum, 1); </span><br/>               <span style="color: #A0A0A0">  58</span> <span style="color: #228B22; background: #FFFFFF;">        % compute distances between projected center and all previous superpixel centers</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  59</span> <span style="color: #000000; background: #FFFFFF;">        norms = sqrt(sum((projectedCenter - prevCenters).^2, 2)); </span><br/>               <span style="color: #A0A0A0">  60</span> <span style="color: #228B22; background: #FFFFFF;">        % find the closest match</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  61</span> <span style="color: #000000; background: #FFFFFF;">        [~, minSpIndex] = min(norms); </span><br/>               <span style="color: #A0A0A0">  62</span> <span style="color: #228B22; background: #FFFFFF;">        % find neighbouring indices of the most likely superpixel from the previous frame</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  63</span> <span style="color: #000000; background: #FFFFFF;">        spArray(i).prevNeighbouringSpInds = <a href="file132.html">findNeighbouringSuperpixelIndices</a>(minSpIndex, framePrev, []); </span><br/>               <span style="color: #A0A0A0">  64</span> <span style="color: #228B22; background: #FFFFFF;">        % calculate interframe similarity between current superpixel and each neighbour</span><br/>               <span style="color: #A0A0A0">  65</span> <span style="color: #A0A0A0; background: #FFFFFF;">        spArray(i).interFrameSimilarity = zeros(length(spArray(i).prevNeighbouringSpInds), 1);</span><br/>               <span style="color: #A0A0A0">  66</span> <span style="color: #A0A0A0; background: #FFFFFF;">        currSp = spArray(i);</span><br/>               <span style="color: #A0A0A0">  67</span> <span style="color: #A0A0A0; background: #FFFFFF;">        for j = 1:length(spArray(i).prevNeighbouringSpInds)</span><br/>               <span style="color: #A0A0A0">  68</span> <span style="color: #A0A0A0; background: #FFFFFF;">            prevSp = framePrev.spArray(spArray(i).prevNeighbouringSpInds(j));</span><br/>               <span style="color: #A0A0A0">  69</span> <span style="color: #A0A0A0; background: #FFFFFF;">            spArray(i).interFrameSimilarity(j) = sum(sqrt(currSp.colorHist(:) .* prevSp.colorHist(:))) * ...</span><br/>               <span style="color: #A0A0A0">  70</span> <span style="color: #A0A0A0; background: #FFFFFF;">                (1 - norm(currSp.center - spMeanFlow - prevSp.center)/framePrev.diagonal);</span><br/>               <span style="color: #A0A0A0">  71</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0">  72</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold">  73</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0">  74</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  75</span> <span style="color: #000000; background: #FFFFFF;">distancesToFrameCenter = [spArray.distanceToFrameCenter]'; </span><br/>               <span style="color: #A0A0A0">  76</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold">  77</span> <span style="color: #000000; background: #FFFFFF;">for i = 1:frameNow.spNum </span><br/>               <span style="color: #A0A0A0">  78</span> <span style="color: #A0A0A0; background: #FFFFFF;">    disp('unvectorized');</span><br/>               <span style="color: #A0A0A0">  79</span> <span style="color: #A0A0A0; background: #FFFFFF;">    unvectorized = tic;</span><br/>               <span style="color: #A0A0A0">  80</span> <span style="color: #A0A0A0; background: #FFFFFF;">    spArray(i).saliencyGlobalContrast = 0;</span><br/>               <span style="color: #A0A0A0">  81</span> <span style="color: #A0A0A0; background: #FFFFFF;">    for j = 1:frameNow.contrastBinCount^3</span><br/>               <span style="color: #A0A0A0">  82</span> <span style="color: #A0A0A0; background: #FFFFFF;">        innerSum = 0;</span><br/>               <span style="color: #A0A0A0">  83</span> <span style="color: #A0A0A0; background: #FFFFFF;">        for k = 1:frameNow.contrastBinCount^3</span><br/>               <span style="color: #A0A0A0">  84</span> <span style="color: #A0A0A0; background: #FFFFFF;">            innerSum = innerSum + norm(frameNow.colorMean(j,:) - frameNow.colorMean(k,:)) * frameNow.colorHist(k);</span><br/>               <span style="color: #A0A0A0">  85</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0">  86</span> <span style="color: #A0A0A0; background: #FFFFFF;">        spArray(i).saliencyGlobalContrast = spArray(i).saliencyGlobalContrast + (spArray(i).colorHist(j) * innerSum);</span><br/>               <span style="color: #A0A0A0">  87</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0">  88</span> <span style="color: #A0A0A0; background: #FFFFFF;">    toc(unvectorized);</span><br/>               <span style="color: #A0A0A0">  89</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0">  90</span> <span style="color: #228B22; background: #FFFFFF;">    % calculate global contrast</span><br/>               <span style="color: #A0A0A0">  91</span> <span style="color: #228B22; background: #FFFFFF;">    % vectorized form of the global contrast saliency calculation. It flattens out the double loop</span><br/>               <span style="color: #A0A0A0">  92</span> <span style="color: #228B22; background: #FFFFFF;">    % into large q^3 x q^3 matrices, computes the inner sum for all combinations of j and k,</span><br/><span style="color: #FF0000">  0.61 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold">  93</span> <span style="color: #228B22; background: #FFFFFF;">    % multiplies each value by the correspoing global contrast bin count at k, sums that value, and </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold">  94</span> <span style="color: #228B22; background: #FFFFFF;">    % then does the outer j sum and multiply with the superpixel color bin count. Higher memory </span><br/><span style="color: #FF0000"> 51.87 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold">  95</span> <span style="color: #228B22; background: #FFFFFF;">    % requirement but much, much faster. ~175x faster! </span><br/><span style="color: #FF0000"> 47.83 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold">  96</span> <span style="color: #000000; background: #FFC6C6;">    disp('matrices'); </span><br/><span style="color: #FF0000"> 46.47 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold">  97</span> <span style="color: #000000; background: #FFC6C6;">    matrices = tic; </span><br/><span style="color: #FF0000"> 46.85 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold">  98</span> <span style="color: #000000; background: #FFC6C6;">    color_l1 = <a href="file141.html">repmat</a>(frameNow.colorMean(:,1), 1, frameNow.contrastBinCount^3); </span><br/><span style="color: #FF0000"> 46.61 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold">  99</span> <span style="color: #000000; background: #FFC6C6;">    color_l2 = <a href="file141.html">repmat</a>(frameNow.colorMean(:,1)', frameNow.contrastBinCount^3, 1); </span><br/><span style="color: #FF0000"> 47.24 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 100</span> <span style="color: #000000; background: #FFC6C6;">    color_a1 = <a href="file141.html">repmat</a>(frameNow.colorMean(:,2), 1, frameNow.contrastBinCount^3); </span><br/>               <span style="color: #A0A0A0"> 101</span> <span style="color: #A0A0A0; background: #FFFFFF;">    color_a2 = repmat(frameNow.colorMean(:,2)', frameNow.contrastBinCount^3, 1);</span><br/><span style="color: #FF0000"> 53.45 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 102</span> <a name="Line102"></a><span style="color: #000000; background: #FFB8B8;">    color_b1 = <a href="file141.html">repmat</a>(frameNow.colorMean(:,3), 1, frameNow.contrastBinCount^3); </span><br/><span style="color: #FF0000"> 53.32 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 103</span> <a name="Line103"></a><span style="color: #000000; background: #FFB8B8;">    color_b2 = <a href="file141.html">repmat</a>(frameNow.colorMean(:,3)', frameNow.contrastBinCount^3, 1); </span><br/><span style="color: #FF0000"> 53.08 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 104</span> <a name="Line104"></a><span style="color: #228B22; background: #FFFFFF;">     </span><br/>               <span style="color: #A0A0A0"> 105</span> <span style="color: #A0A0A0; background: #FFFFFF;">    color_l_diff = color_l1 - color_l2;</span><br/><span style="color: #FF0000"> 101.32 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 106</span> <a name="Line106"></a><span style="color: #000000; background: #FF8080;">    color_a_diff = color_a1 - color_a2; </span><br/><span style="color: #FF0000"> 46.79 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 107</span> <span style="color: #000000; background: #FFC6C6;">    color_b_diff = color_b1 - color_b2; </span><br/><span style="color: #FF0000"> 62.58 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 108</span> <a name="Line108"></a><span style="color: #228B22; background: #FFFFFF;">     </span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 109</span> <span style="color: #000000; background: #FFFFFF;">    color_norm = sqrt(color_l_diff.^2 + color_a_diff.^2 + color_b_diff.^2); </span><br/><span style="color: #FF0000">  0.14 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 110</span> <span style="color: #000000; background: #FFFFFF;">    globalColorHist = <a href="file141.html">repmat</a>(frameNow.colorHist(:), 1, frameNow.contrastBinCount^3); </span><br/>               <span style="color: #A0A0A0"> 111</span> <span style="color: #A0A0A0; background: #FFFFFF;">    innerSum = sum(color_norm.*globalColorHist, 1);</span><br/>               <span style="color: #A0A0A0"> 112</span> <span style="color: #A0A0A0; background: #FFFFFF;">    spArray(i).saliencyGlobalContrast = spArray(i).colorHist(:)'*innerSum';</span><br/>               <span style="color: #A0A0A0"> 113</span> <span style="color: #A0A0A0; background: #FFFFFF;">    toc(matrices);</span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 114</span> <span style="color: #228B22; background: #FFFFFF;">     </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 115</span> <span style="color: #228B22; background: #FFFFFF;">    % TODO: see if I can't vectorize this better, just worried about memory constraints: </span><br/><span style="color: #FF0000">  0.03 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 116</span> <span style="color: #228B22; background: #FFFFFF;">    % 700x700x4096 * 2 for the first term... </span><br/>       <span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 117</span> <span style="color: #000000; background: #FFFFFF;">    disp('loop'); </span><br/><span style="color: #FF0000"> 27.70 </span><span style="color: #0000FF"> 459684 </span><span style="color: #000000; font-weight: bold"> 118</span> <span style="color: #000000; background: #FFE2E2;">    loop = tic; </span><br/>               <span style="color: #A0A0A0"> 119</span> <span style="color: #A0A0A0; background: #FFFFFF;">    spArray(i).intraFrameSimilarity = zeros(frameNow.spNum, 1);</span><br/><span style="color: #FF0000">  0.14 </span><span style="color: #0000FF"> 459684 </span><span style="color: #000000; font-weight: bold"> 120</span> <span style="color: #000000; background: #FFFFFF;">    for j = 1:frameNow.spNum </span><br/>               <span style="color: #A0A0A0"> 121</span> <span style="color: #A0A0A0; background: #FFFFFF;">        spArray(i).intraFrameSimilarity(j) = sum(sqrt(spArray(i).colorHist(:) .* spArray(j).colorHist(:))) * ...</span><br/><span style="color: #FF0000">  0.04 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 122</span> <span style="color: #A0A0A0; background: #FFFFFF;">            (1 - norm(spArray(i).center - spArray(j).center)/frameNow.diagonal); </span><br/><span style="color: #FF0000">  0.11 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 123</span> <span style="color: #000000; background: #FFFFFF;">    end </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 124</span> <span style="color: #228B22; background: #FFFFFF;">     </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 125</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).colorSpatialDistribution = sum(spArray(i).intraFrameSimilarity.*distancesToFrameCenter)/sum(spArray(i).intraFrameSimilarity); </span><br/>               <span style="color: #A0A0A0"> 126</span> <span style="color: #A0A0A0; background: #FFFFFF;">    toc(loop);</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 127</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 128</span> <span style="color: #000000; background: #FFFFFF;">toc </span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 129</span> <span style="color: #228B22; background: #FFFFFF;">% calculate saliencySpatialSparcity and saliencySpatial </span><br/>       <span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 130</span> <span style="color: #000000; background: #FFFFFF;">maxColorSpatialDistribution = max([spArray.colorSpatialDistribution]); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 131</span> <span style="color: #000000; background: #FFFFFF;">minColorSpatialDistribution = min([spArray.colorSpatialDistribution]); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 132</span> <span style="color: #000000; background: #FFFFFF;">for i = 1:frameNow.spNum </span><br/>               <span style="color: #A0A0A0"> 133</span> <span style="color: #A0A0A0; background: #FFFFFF;">    spArray(i).saliencySpatialSparcity = (maxColorSpatialDistribution - spArray(i).colorSpatialDistribution)/(maxColorSpatialDistribution - minColorSpatialDistribution);</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 134</span> <span style="color: #000000; background: #FFFFFF;">    spArray(i).saliencySpatial = spArray(i).saliencySpatialSparcity * spArray(i).saliencyGlobalContrast; </span><br/>               <span style="color: #A0A0A0"> 135</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/><span style="color: #FF0000">  0.18 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 136</span> <span style="color: #228B22; background: #FFFFFF;"> </span><br/>               <span style="color: #A0A0A0"> 137</span> <span style="color: #A0A0A0; background: #FFFFFF;">for i = 1:frameNow.spNum</span><br/><span style="color: #FF0000">  0.06 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 138</span> <span style="color: #228B22; background: #FFFFFF;">    % find neighbour indices for each superpixel in the current frame </span><br/>               <span style="color: #A0A0A0"> 139</span> <span style="color: #A0A0A0; background: #FFFFFF;">    spArray(i).nowNeighbouringSpInds = findNeighbouringSuperpixelIndices(i, frameNow, spArray);</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 140</span> <span style="color: #228B22; background: #FFFFFF;">    % get the bin indices of each pixel in the superpixel </span><br/>       <span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 141</span> <span style="color: #000000; background: #FFFFFF;">    colorBinInds = <a href="file145.html">sub2ind</a>(<a href="file141.html">repmat</a>(frameNow.contrastBinCount, 1, 3), spArray(i).colorLoc(:,1), spArray(i).colorLoc(:,2), spArray(i).colorLoc(:,3)); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 142</span> <span style="color: #228B22; background: #FFFFFF;">    % compute the pixel-level spatial saliency score for each pixel in the superpixel </span><br/><span style="color: #FF0000">  0.02 </span><span style="color: #0000FF">   3789 </span><span style="color: #000000; font-weight: bold"> 143</span> <span style="color: #000000; background: #FFFFFF;">    numeratorSum = zeros(spArray(i).pixelCount, 1); </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">   3789 </span><span style="color: #000000; font-weight: bold"> 144</span> <span style="color: #000000; background: #FFFFFF;">    denomenatorSum = zeros(spArray(i).pixelCount, 1); </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">   3789 </span><span style="color: #000000; font-weight: bold"> 145</span> <span style="color: #000000; background: #FFFFFF;">    for j = 1:length(spArray(i).nowNeighbouringSpInds) </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 146</span> <span style="color: #000000; background: #FFFFFF;">        numeratorSum = numeratorSum + (spArray(j).saliencySpatial * spArray(j).colorHist(colorBinInds)); </span><br/>       <span style="color: #0000FF">    678 </span><span style="color: #000000; font-weight: bold"> 147</span> <span style="color: #000000; background: #FFFFFF;">        denomenatorSum = denomenatorSum + spArray(j).colorHist(colorBinInds); </span><br/>               <span style="color: #A0A0A0"> 148</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 149</span> <span style="color: #A0A0A0; background: #FFFFFF;">    saliencySpatial(spArray(i).pixelInds) = numeratorSum./denomenatorSum;</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 150</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 151</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 152</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 153</span> <span style="color: #A0A0A0; background: #FFFFFF;">if frameNow.frameNum ~= 1</span><br/>               <span style="color: #A0A0A0"> 154</span> <span style="color: #228B22; background: #FFFFFF;">    % calculate motion distinctiveness</span><br/>               <span style="color: #A0A0A0"> 155</span> <span style="color: #228B22; background: #FFFFFF;">    % vectorized form of the motion distinctiveness calculation. It flattens out the double loop</span><br/>               <span style="color: #A0A0A0"> 156</span> <span style="color: #228B22; background: #FFFFFF;">    % into large q^2 x q^2 matrices, computes the inner sum for all combinations of j and k,</span><br/>               <span style="color: #A0A0A0"> 157</span> <span style="color: #228B22; background: #FFFFFF;">    % multiplies each value by the correspoing global motion bin count at k, sums that value, and</span><br/>               <span style="color: #A0A0A0"> 158</span> <span style="color: #228B22; background: #FFFFFF;">    % then does the outer j sum and multiply with the superpixel motion bin count. Higher memory</span><br/>               <span style="color: #A0A0A0"> 159</span> <span style="color: #228B22; background: #FFFFFF;">    % requirement but much, much faster.</span><br/>               <span style="color: #A0A0A0"> 160</span> <span style="color: #A0A0A0; background: #FFFFFF;">    for i = 1:frameNow.spNum</span><br/>               <span style="color: #A0A0A0"> 161</span> <span style="color: #A0A0A0; background: #FFFFFF;">        flow_u1 = repmat(frameNow.motionMeanCart(:,1), 1, frameNow.motionBinCount^2);</span><br/>               <span style="color: #A0A0A0"> 162</span> <span style="color: #A0A0A0; background: #FFFFFF;">        flow_u2 = repmat(frameNow.motionMeanCart(:,1)', frameNow.motionBinCount^2, 1);</span><br/>               <span style="color: #A0A0A0"> 163</span> <span style="color: #A0A0A0; background: #FFFFFF;">        flow_v1 = repmat(frameNow.motionMeanCart(:,2), 1, frameNow.motionBinCount^2);</span><br/>               <span style="color: #A0A0A0"> 164</span> <span style="color: #A0A0A0; background: #FFFFFF;">        flow_v2 = repmat(frameNow.motionMeanCart(:,2)', frameNow.motionBinCount^2, 1);</span><br/>               <span style="color: #A0A0A0"> 165</span> <span style="color: #228B22; background: #FFFFFF;">        </span><br/>               <span style="color: #A0A0A0"> 166</span> <span style="color: #A0A0A0; background: #FFFFFF;">        flow_u_diff = flow_u1 - flow_u2;</span><br/>               <span style="color: #A0A0A0"> 167</span> <span style="color: #A0A0A0; background: #FFFFFF;">        flow_v_diff = flow_v1 - flow_v2;</span><br/>               <span style="color: #A0A0A0"> 168</span> <span style="color: #228B22; background: #FFFFFF;">        </span><br/>               <span style="color: #A0A0A0"> 169</span> <span style="color: #A0A0A0; background: #FFFFFF;">        flow_norm = sqrt(flow_u_diff.^2 + flow_v_diff.^2);</span><br/>               <span style="color: #A0A0A0"> 170</span> <span style="color: #228B22; background: #FFFFFF;">        </span><br/>               <span style="color: #A0A0A0"> 171</span> <span style="color: #A0A0A0; background: #FFFFFF;">        globalMotionHist = repmat(frameNow.motionHist(:), 1, frameNow.motionBinCount^2);</span><br/>               <span style="color: #A0A0A0"> 172</span> <span style="color: #A0A0A0; background: #FFFFFF;">        innerSum = sum(flow_norm.*globalMotionHist, 1);</span><br/>               <span style="color: #A0A0A0"> 173</span> <span style="color: #A0A0A0; background: #FFFFFF;">        spArray(i).saliencyMotionDistinctiveness = spArray(i).motionHist(:)'*innerSum';</span><br/>               <span style="color: #A0A0A0"> 174</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 175</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0"> 176</span> <span style="color: #228B22; background: #FFFFFF;">    % calculate motion significance</span><br/>               <span style="color: #A0A0A0"> 177</span> <span style="color: #A0A0A0; background: #FFFFFF;">    motionSignificance = sum([spArray.saliencyMotionDistinctiveness].*[spArray.pixelCount]);</span><br/>               <span style="color: #A0A0A0"> 178</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if frameNow.frameNum == 2</span><br/>               <span style="color: #A0A0A0"> 179</span> <span style="color: #A0A0A0; background: #FFFFFF;">        motionSignificanceHistory = motionSignificance;</span><br/>               <span style="color: #A0A0A0"> 180</span> <span style="color: #228B22; background: #FFFFFF;">    else</span><br/>               <span style="color: #A0A0A0"> 181</span> <span style="color: #228B22; background: #FFFFFF;">        % calculate the adjustment weight based on motion significance for each frame</span><br/>               <span style="color: #A0A0A0"> 182</span> <span style="color: #A0A0A0; background: #FFFFFF;">        adjustmentWeight = max(median(framePrev.motionSignificanceHistory)/(median(framePrev.motionSignificanceHistory) + motionSignificance), 0.5);</span><br/>               <span style="color: #A0A0A0"> 183</span> <span style="color: #A0A0A0; background: #FFFFFF;">        motionSignificanceHistory = [framePrev.motionSignificanceHistory motionSignificance];</span><br/>               <span style="color: #A0A0A0"> 184</span> <span style="color: #A0A0A0; background: #FFFFFF;">        motionSignificanceHistory = motionSignificanceHistory(max(length(motionSignificanceHistory)- motionSignigicanceWinLength, 1):end);</span><br/>               <span style="color: #A0A0A0"> 185</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 186</span> <span style="color: #228B22; background: #FFFFFF;">    </span><br/>               <span style="color: #A0A0A0"> 187</span> <span style="color: #228B22; background: #FFFFFF;">    % TODO: double loop, see if I can't collapse it/vectorize it</span><br/>               <span style="color: #A0A0A0"> 188</span> <span style="color: #A0A0A0; background: #FFFFFF;">    for i = 1:frameNow.spNum</span><br/>               <span style="color: #A0A0A0"> 189</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if frameNow.frameNum == 2</span><br/>               <span style="color: #A0A0A0"> 190</span> <span style="color: #228B22; background: #FFFFFF;">            % no previous saliency value on first motion frame, just use motion distinctiveness</span><br/>               <span style="color: #A0A0A0"> 191</span> <span style="color: #A0A0A0; background: #FFFFFF;">            spArray(i).saliencyTemporal = spArray(i).saliencyMotionDistinctiveness;</span><br/>               <span style="color: #A0A0A0"> 192</span> <span style="color: #228B22; background: #FFFFFF;">        else</span><br/>               <span style="color: #A0A0A0"> 193</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if sum(spArray(i).interFrameSimilarity) &gt; 0</span><br/>               <span style="color: #A0A0A0"> 194</span> <span style="color: #228B22; background: #FFFFFF;">                % calculate temporal saliency prediction</span><br/>               <span style="color: #A0A0A0"> 195</span> <span style="color: #A0A0A0; background: #FFFFFF;">                prevTemporalSaliency = [framePrev.spArray(spArray(i).prevNeighbouringSpInds).saliencyTemporal]';</span><br/>               <span style="color: #A0A0A0"> 196</span> <span style="color: #A0A0A0; background: #FFFFFF;">                spArray(i).saliencyTemporalPrediction = sum(spArray(i).interFrameSimilarity.*prevTemporalSaliency)/sum(spArray(i).interFrameSimilarity);</span><br/>               <span style="color: #A0A0A0"> 197</span> <span style="color: #228B22; background: #FFFFFF;">                </span><br/>               <span style="color: #A0A0A0"> 198</span> <span style="color: #228B22; background: #FFFFFF;">                % calculate temporal saliency by adjustment</span><br/>               <span style="color: #A0A0A0"> 199</span> <span style="color: #A0A0A0; background: #FFFFFF;">                spArray(i).saliencyTemporal = adjustmentWeight*spArray(i).saliencyTemporalPrediction + ...</span><br/>               <span style="color: #A0A0A0"> 200</span> <span style="color: #A0A0A0; background: #FFFFFF;">                    (1 - adjustmentWeight)*spArray(i).saliencyMotionDistinctiveness;</span><br/>               <span style="color: #A0A0A0"> 201</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 202</span> <span style="color: #A0A0A0; background: #FFFFFF;">                spArray(i).saliencyTemporalPrediction = 0;</span><br/>               <span style="color: #A0A0A0"> 203</span> <span style="color: #A0A0A0; background: #FFFFFF;">                spArray(i).saliencyTemporal = spArray(i).saliencyMotionDistinctiveness;</span><br/>               <span style="color: #A0A0A0"> 204</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 205</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 206</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>       <span style="color: #0000FF">      1 </span><span style="color: #000000; font-weight: bold"> 207</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 208</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 209</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/></pre><p><p>Other subfunctions in this file are not included in this listing.</body></html>